# База данных кондитерской
## Документация по проекту системы автоматизации

---

## 1. Общее описание системы

Система предназначена для автоматизации деятельности кондитерской и включает в себя:
- Управление ассортиментом продукции
- Прием и обработку заказов
- Учет ингредиентов и сырья
- Управление персоналом
- Работу с поставщиками
- Отчетность и аналитику

---

## 2. Структура базы данных

### Основные таблицы

#### **categories** - Категории продукции
Хранит классификацию выпускаемой продукции.

| Поле | Тип | Описание |
|------|-----|----------|
| category_id | INT (PK) | Уникальный идентификатор категории |
| name | VARCHAR(100) | Название категории |
| description | TEXT | Описание категории |
| created_at | TIMESTAMP | Дата создания записи |
| updated_at | TIMESTAMP | Дата последнего обновления |

#### **units** - Единицы измерения
Справочник единиц измерения для ингредиентов.

| Поле | Тип | Описание |
|------|-----|----------|
| unit_id | INT (PK) | Уникальный идентификатор единицы |
| name | VARCHAR(50) | Полное название единицы |
| abbreviation | VARCHAR(10) | Сокращенное обозначение |

#### **ingredients** - Ингредиенты и сырье
Справочник ингредиентов с остатками на складе.

| Поле | Тип | Описание |
|------|-----|----------|
| ingredient_id | INT (PK) | Уникальный идентификатор ингредиента |
| name | VARCHAR(150) | Название ингредиента |
| unit_id | INT (FK) | Единица измерения |
| cost_per_unit | DECIMAL(10,2) | Стоимость за единицу |
| min_stock_level | INT | Минимальный остаток |
| current_stock | INT | Текущий остаток |
| created_at | TIMESTAMP | Дата создания записи |
| updated_at | TIMESTAMP | Дата последнего обновления |

#### **products** - Продукция
Каталог выпускаемой продукции.

| Поле | Тип | Описание |
|------|-----|----------|
| product_id | INT (PK) | Уникальный идентификатор продукта |
| name | VARCHAR(200) | Название продукта |
| category_id | INT (FK) | Категория продукта |
| description | TEXT | Описание продукта |
| price | DECIMAL(10,2) | Цена продажи |
| cost | DECIMAL(10,2) | Себестоимость |
| weight_grams | INT | Вес в граммах |
| shelf_life_hours | INT | Срок годности в часах |
| is_custom | BOOLEAN | Индивидуальный заказ |
| is_active | BOOLEAN | Активен ли продукт |
| recipe_yield | INT | Выход рецептуры |
| created_at | TIMESTAMP | Дата создания записи |
| updated_at | TIMESTAMP | Дата последнего обновления |

#### **recipes** - Рецептуры
Связывает продукцию с ингредиентами и их количеством.

| Поле | Тип | Описание |
|------|-----|----------|
| recipe_id | INT (PK) | Уникальный идентификатор рецепта |
| product_id | INT (FK) | Продукт |
| ingredient_id | INT (FK) | Ингредиент |
| quantity | DECIMAL(8,3) | Количество ингредиента |

#### **positions** - Должности
Справочник должностей сотрудников.

| Поле | Тип | Описание |
|------|-----|----------|
| position_id | INT (PK) | Уникальный идентификатор должности |
| title | VARCHAR(100) | Название должности |
| salary_min | DECIMAL(10,2) | Минимальная зарплата |
| salary_max | DECIMAL(10,2) | Максимальная зарплата |

#### **employees** - Сотрудники
Справочник сотрудников.

| Поле | Тип | Описание |
|------|-----|----------|
| employee_id | INT (PK) | Уникальный идентификатор сотрудника |
| first_name | VARCHAR(100) | Имя |
| last_name | VARCHAR(100) | Фамилия |
| middle_name | VARCHAR(100) | Отчество |
| position_id | INT (FK) | Должность |
| salary | DECIMAL(10,2) | Заработная плата |
| phone | VARCHAR(20) | Телефон |
| email | VARCHAR(150) | Email |
| hire_date | DATE | Дата приема на работу |
| is_active | BOOLEAN | Работает ли сотрудник |
| created_at | TIMESTAMP | Дата создания записи |

#### **customers** - Клиенты
База клиентов с системой скидок.

| Поле | Тип | Описание |
|------|-----|----------|
| customer_id | INT (PK) | Уникальный идентификатор клиента |
| first_name | VARCHAR(100) | Имя |
| last_name | VARCHAR(100) | Фамилия |
| middle_name | VARCHAR(100) | Отчество |
| phone | VARCHAR(20) | Телефон |
| email | VARCHAR(150) | Email |
| birth_date | DATE | Дата рождения |
| discount_percent | DECIMAL(5,2) | Размер скидки в % |
| total_orders | INT | Общее количество заказов |
| total_spent | DECIMAL(12,2) | Общая сумма покупок |
| created_at | TIMESTAMP | Дата создания записи |
| updated_at | TIMESTAMP | Дата последнего обновления |

#### **order_statuses** - Статусы заказов
Справочник статусов заказов.

| Поле | Тип | Описание |
|------|-----|----------|
| status_id | INT (PK) | Уникальный идентификатор статуса |
| name | VARCHAR(50) | Название статуса |
| description | TEXT | Описание статуса |

#### **orders** - Заказы
Основная таблица заказов.

| Поле | Тип | Описание |
|------|-----|----------|
| order_id | INT (PK) | Уникальный идентификатор заказа |
| customer_id | INT (FK) | Клиент |
| employee_id | INT (FK) | Сотрудник, принявший заказ |
| status_id | INT (FK) | Статус заказа |
| order_date | TIMESTAMP | Дата заказа |
| required_date | DATETIME | Требуемая дата готовности |
| completion_date | DATETIME | Фактическая дата завершения |
| total_amount | DECIMAL(12,2) | Общая сумма |
| discount_amount | DECIMAL(10,2) | Сумма скидки |
| final_amount | DECIMAL(12,2) | Итоговая сумма к оплате |
| payment_method | ENUM | Способ оплаты |
| is_paid | BOOLEAN | Оплачен ли заказ |
| notes | TEXT | Примечания |
| created_at | TIMESTAMP | Дата создания записи |
| updated_at | TIMESTAMP | Дата последнего обновления |

#### **order_items** - Позиции заказа
Состав заказа по позициям.

| Поле | Тип | Описание |
|------|-----|----------|
| item_id | INT (PK) | Уникальный идентификатор позиции |
| order_id | INT (FK) | Заказ |
| product_id | INT (FK) | Продукт |
| quantity | INT | Количество |
| unit_price | DECIMAL(10,2) | Цена за единицу |
| total_price | DECIMAL(12,2) | Общая стоимость позиции |
| custom_notes | TEXT | Индивидуальные пожелания |

#### **suppliers** - Поставщики
Справочник поставщиков.

| Поле | Тип | Описание |
|------|-----|----------|
| supplier_id | INT (PK) | Уникальный идентификатор поставщика |
| company_name | VARCHAR(200) | Название компании |
| contact_person | VARCHAR(150) | Контактное лицо |
| phone | VARCHAR(20) | Телефон |
| email | VARCHAR(150) | Email |
| address | TEXT | Адрес |
| inn | VARCHAR(20) | ИНН |
| is_active | BOOLEAN | Активный поставщик |
| created_at | TIMESTAMP | Дата создания записи |

#### **supplies** - Поставки
Поставки товаров от поставщиков.

| Поле | Тип | Описание |
|------|-----|----------|
| supply_id | INT (PK) | Уникальный идентификатор поставки |
| supplier_id | INT (FK) | Поставщик |
| employee_id | INT (FK) | Сотрудник, принявший поставку |
| supply_date | TIMESTAMP | Дата поставки |
| total_amount | DECIMAL(12,2) | Общая стоимость поставки |
| is_received | BOOLEAN | Получена ли поставка |
| notes | TEXT | Примечания |

#### **supply_items** - Позиции поставки
Состав поставки по позициям.

| Поле | Тип | Описание |
|------|-----|----------|
| supply_item_id | INT (PK) | Уникальный идентификатор позиции |
| supply_id | INT (FK) | Поставка |
| ingredient_id | INT (FK) | Ингредиент |
| quantity | DECIMAL(8,3) | Количество |
| unit_price | DECIMAL(10,2) | Цена за единицу |
| total_price | DECIMAL(12,2) | Общая стоимость позиции |

---

## 3. Связи между таблицами

### Основные связи

1. **products.category_id -> categories.category_id**
   - Каждый продукт принадлежит определенной категории

2. **products <-> ingredients** (через recipes)
   - Продукты связаны с ингредиентами через рецептуры

3. **orders.customer_id -> customers.customer_id**
   - Заказ может быть привязан к клиенту (или быть анонимным)

4. **orders.employee_id -> employees.employee_id**
   - Каждый заказ принимает определенный сотрудник

5. **orders.status_id -> order_statuses.status_id**
   - Каждый заказ имеет определенный статус

6. **order_items.order_id -> orders.order_id**
   - Позиции заказа принадлежат определенному заказу

7. **employees.position_id -> positions.position_id**
   - Каждый сотрудник имеет определенную должность

8. **supplies.supplier_id -> suppliers.supplier_id**
   - Каждая поставка от определенного поставщика
  
![image](https://github.com/user-attachments/assets/cb0e4736-e20b-4050-a94b-a873a7f9fbc1)


---

## 4. Представления (Views)

### 4.1 view_products_full
Полная информация о продукции с названиями категорий.

**Назначение:** Упрощение получения полной информации о продуктах для отображения в каталоге.

### 4.2 view_active_orders
Список активных заказов с информацией о клиентах и сотрудниках.

**Назначение:** Мониторинг текущих заказов в работе.

### 4.3 view_order_details
Детальный состав заказов.

**Назначение:** Просмотр состава конкретного заказа.

### 4.4 view_inventory_status
Состояние складских остатков с индикаторами статуса.

**Назначение:** Контроль остатков и планирование закупок.

---

## 5. Автоматизация и триггеры

### 5.1 Триггер обновления остатков при поставке
**tr_update_stock_on_supply**

Автоматически обновляет остатки ингредиентов при подтверждении получения поставки.

### 5.2 Триггер обновления суммы заказа
**tr_update_order_total**

Автоматически пересчитывает общую сумму заказа при добавлении новых позиций.

### 5.3 Триггер обновления статистики клиента
**tr_update_customer_stats**

Обновляет статистику клиента (количество заказов и общую сумму покупок) при выдаче заказа.

---

## 6. Хранимые процедуры

### 6.1 sp_create_order
Создание нового заказа с автоматическим расчетом скидки клиента.

### 6.2 sp_add_order_item
Добавление позиции в заказ с автоматическим расчетом стоимости.

---
